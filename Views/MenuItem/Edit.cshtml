@model IEnumerable<DoAnChuyenNganh.Models.MenuItem>
@{
    var restaurant = ViewBag.Restaurant as DoAnChuyenNganh.Models.Restaurant;
    ViewData["Title"] = "Chỉnh sửa thực đơn - " + restaurant?.Name;
}

<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />

<div class="container py-5">
    <div class="card p-5 shadow">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-warning">
                <i class="bi bi-pencil-square me-2"></i>Chỉnh sửa thực đơn cho @restaurant?.Name
            </h3>
            <a asp-controller="Restaurant" asp-action="Index" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle"></i> Quay lại
            </a>
        </div>

        <form asp-action="Edit" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RestaurantId" value="@restaurant?.Id" />

            <div class="row g-4">
                @foreach (var item in Model)
                {
                    <div class="col-md-6">
                        <div class="border rounded p-3 bg-light shadow-sm position-relative">
                            <input type="hidden" name="ItemIds" value="@item.Id" />

                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="fw-semibold text-dark">Tên món</label>
                                <button type="button" class="btn btn-sm btn-outline-danger"
                                        onclick="confirmDelete(@item.Id, '@item.Name')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>

                            <input type="text" name="Names" value="@item.Name" class="form-control mb-2" />

                            <label class="form-label fw-semibold">Giá</label>
                            <input type="number" step="0.01" name="Prices" value="@item.Price" class="form-control mb-2" />

                            <label class="form-label fw-semibold">Mô tả</label>
                            <textarea name="Descriptions" class="form-control mb-2">@item.Description</textarea>

                            <label class="form-label fw-semibold">Ảnh hiện tại</label><br />
                            @if (!string.IsNullOrEmpty(item.ImageUrl))
                            {
                                <img src="@item.ImageUrl" class="img-fluid rounded mb-2" style="max-height:100px;" />
                            }

                            <input type="file" name="Images" class="form-control" accept="image/*" />
                        </div>
                    </div>
                }
            </div>

            <div class="text-end mt-4">
                <button type="submit" class="btn btn-warning btn-lg px-4">
                    <i class="bi bi-save"></i> Lưu thay đổi
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        function confirmDelete(itemId, itemName) {
            Swal.fire({
                title: 'Xóa món "' + itemName + '"?',
                text: 'Hành động này sẽ không thể hoàn tác!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy',
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/MenuItem/Delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: 'id=' + encodeURIComponent(itemId)
                    })
                    .then(response => {
                        if (response.ok) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Đã xóa!',
                                text: 'Món ăn đã được xóa thành công.',
                                timer: 1500,
                                showConfirmButton: false
                            }).then(() => location.reload());
                        } else {
                            Swal.fire('Lỗi', 'Không thể xóa món ăn (HTTP ' + response.status + ')', 'error');
                        }
                    });
                }
            });
        }
    </script>
}
