@{
    ViewData["Title"] = "Thêm thực đơn cho nhà hàng";
    var restaurant = ViewBag.Restaurant as DoAnChuyenNganh.Models.Restaurant;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />

<div class="container mt-4">
    <h2 class="mb-3 text-center text-primary">
        <i class="bi bi-journal-plus me-2"></i>Thêm thực đơn cho nhà hàng:
        <span class="text-dark">@restaurant?.Name</span>
    </h2>

    <!-- 🥘 FORM THÊM TỪNG MÓN -->
    <form asp-action="CreateMultiple" method="post" enctype="multipart/form-data" id="menuForm">
        <input type="hidden" name="RestaurantId" value="@restaurant?.Id" />

        <div id="menuItems">
            <div class="menu-item card mb-3 p-3 border rounded shadow-sm">
                <div class="row g-3 align-items-center">
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Tên món</label>
                        <input type="text" name="Names" class="form-control" placeholder="VD: Mì Ý Bò Bằm" required />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-bold">Giá (VNĐ)</label>
                        <input type="number" name="Prices" class="form-control" step="1000" min="0" placeholder="50000" required />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Mô tả</label>
                        <textarea name="Descriptions" class="form-control" rows="1" placeholder="Ngon, nóng hổi, hấp dẫn..."></textarea>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-bold">Phân loại</label>
                        <select name="Categories" class="form-select" required>
                            <option value="">-- Chọn phân loại --</option>
                            <option value="Khai vị">Khai vị</option>
                            <option value="Món chính">Món chính</option>
                            <option value="Tráng miệng">Tráng miệng</option>
                            <option value="Nước uống">Nước uống</option>
                        </select>
                    </div>
                    <div class="col-md-2 text-center">
                        <label class="form-label fw-bold">Hình ảnh</label>
                        <input type="file" name="Images" class="form-control" accept="image/*" onchange="previewImage(this)" />
                        <img src="#" class="img-preview mt-2 rounded" style="max-width:100%;display:none;" />
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button type="button" id="addRow" class="btn btn-outline-primary">
                <i class="bi bi-plus-circle me-1"></i> Thêm món
            </button>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-save me-1"></i> Lưu thực đơn
            </button>
        </div>
    </form>

    <!-- 🖼️ FORM THÊM THỰC ĐƠN BẰNG HÌNH ẢNH -->
    <div class="text-center mt-5 border-top pt-4">
        <h5 class="text-secondary mb-3">Hoặc thêm thực đơn bằng hình ảnh</h5>

        <form asp-action="UploadMenuImage" method="post" enctype="multipart/form-data" id="menuImageForm" class="d-inline-block">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RestaurantId" value="@restaurant?.Id" />
            <input type="file" name="MenuImages" class="form-control mb-3" multiple accept="image/*" required />
            <button type="submit" class="btn btn-outline-success">
                <i class="bi bi-image me-1"></i> Thêm bằng hình ảnh
            </button>
        </form>
    </div>

    <div class="mt-4">
        <a asp-controller="Restaurant" asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại danh sách
        </a>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
        document.getElementById("menuImageForm").addEventListener("submit", function(e) {
        e.preventDefault();
        Swal.fire({
            title: "Tải hình ảnh thực đơn?",
            text: "Những hình ảnh này sẽ được lưu trực tiếp vào nhà hàng.",
            icon: "info",
            showCancelButton: true,
            confirmButtonText: "Tải lên",
            cancelButtonText: "Hủy"
        }).then(result => {
            if (result.isConfirmed) this.submit();
        });
    });
    // ✅ Thêm dòng món mới
    document.getElementById("addRow").addEventListener("click", function () {
        const firstItem = document.querySelector(".menu-item");
        const newItem = firstItem.cloneNode(true);

        newItem.querySelectorAll("input, textarea").forEach(el => {
            if (el.type === "file") {
                el.value = "";
            } else {
                el.value = "";
            }
        });
        newItem.querySelector(".img-preview").style.display = "none";

        document.getElementById("menuItems").appendChild(newItem);
    });

    // ✅ Xem trước hình ảnh
    function previewImage(input) {
        const preview = input.nextElementSibling;
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(file);
        } else {
            preview.style.display = "none";
        }
    }

    // ✅ Xác nhận lưu
    document.getElementById("menuForm").addEventListener("submit", function (e) {
        e.preventDefault();
        Swal.fire({
            title: "Xác nhận lưu?",
            text: "Bạn có chắc chắn muốn lưu thực đơn này?",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Lưu ngay",
            cancelButtonText: "Hủy"
        }).then(result => {
            if (result.isConfirmed) this.submit();
        });
    });
</script>
